{% extends "tailwind_layout.html" %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="fitness-card">
        <div class="flex items-center gap-3 mb-6">
            <svg class="icon text-fitness-red">
                <use xlink:href="#icon-settings"></use>
            </svg>
            <h2 class="text-3xl font-bold">Account Settings</h2>
        </div>
        
        <!-- Tabs Navigation -->
        <div class="border-b border-gray-800 mb-6">
            <div class="flex flex-wrap -mb-px">
                <button class="tab-btn active px-4 py-2 font-bold border-b-2 border-fitness-red" 
                        data-tab="profile">
                    Profile
                </button>
                <button class="tab-btn px-4 py-2 font-bold border-b-2 border-transparent text-fitness-gray hover:text-white" 
                        data-tab="security">
                    Security
                </button>
                <button class="tab-btn px-4 py-2 font-bold border-b-2 border-transparent text-fitness-gray hover:text-white" 
                        data-tab="notifications">
                    Notifications
                </button>
                <button class="tab-btn px-4 py-2 font-bold border-b-2 border-transparent text-fitness-gray hover:text-white" 
                        data-tab="privacy">
                    Privacy
                </button>
            </div>
        </div>
        
        <!-- Tab Contents -->
        <div>
            <!-- Profile Tab -->
            <div id="profile-tab" class="tab-content active">
                <form id="profile-settings-form">
                    <div class="mb-4">
                        <label for="fullname" class="block text-fitness-gray mb-2">Full Name</label>
                        <input type="text" class="fitness-input" id="fullname" name="fullname" value="{{ user.username }}">
                    </div>
                    <div class="mb-4">
                        <label for="email" class="block text-fitness-gray mb-2">Email Address</label>
                        <input type="email" class="fitness-input" id="email" name="email" value="{{ user.email }}">
                    </div>
                    <div class="mb-4">
                        <label for="bio" class="block text-fitness-gray mb-2">Bio</label>
                        <textarea class="fitness-input" id="bio" name="bio" rows="3" placeholder="Tell us about yourself and your fitness journey">{{ user.bio }}</textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-fitness-gray mb-2">Profile Picture</label>
                        <div class="flex items-center">
                            <div class="w-16 h-16 bg-fitness-darkgray rounded-full overflow-hidden mr-4 border-2 border-fitness-red">
                                <svg class="icon w-full h-full p-4 text-fitness-red">
                                    <use xlink:href="#icon-user"></use>
                                </svg>
                            </div>
                            <div class="flex gap-2">
                                <button type="button" class="btn btn-outline py-1 px-3 flex items-center gap-2">
                                    <svg class="icon icon-sm">
                                        <use xlink:href="#icon-upload"></use>
                                    </svg>
                                    <span>Upload New</span>
                                </button>
                                <button type="button" class="btn btn-outline py-1 px-3 flex items-center gap-2">
                                    <svg class="icon icon-sm">
                                        <use xlink:href="#icon-trash"></use>
                                    </svg>
                                    <span>Remove</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6">
                        <button type="submit" class="btn btn-primary flex items-center gap-2">
                            <svg class="icon icon-sm">
                                <use xlink:href="#icon-save"></use>
                            </svg>
                            <span>Save Profile Changes</span>
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Security Tab -->
            <div id="security-tab" class="tab-content hidden">
                <form id="password-change-form">
                    <div class="mb-4">
                        <label for="current-password" class="block text-fitness-gray mb-2">Current Password</label>
                        <input type="password" class="fitness-input" id="current-password" name="current-password">
                    </div>
                    <div class="mb-4">
                        <label for="new-password" class="block text-fitness-gray mb-2">New Password</label>
                        <input type="password" class="fitness-input" id="new-password" name="new-password">
                        <p class="text-fitness-gray text-sm mt-1">Password must be at least 8 characters with letters, numbers, and symbols.</p>
                    </div>
                    <div class="mb-4">
                        <label for="confirm-password" class="block text-fitness-gray mb-2">Confirm New Password</label>
                        <input type="password" class="fitness-input" id="confirm-password" name="confirm-password">
                    </div>
                    <div class="mt-6">
                        <button type="submit" class="btn btn-primary flex items-center gap-2">
                            <svg class="icon icon-sm">
                                <use xlink:href="#icon-save"></use>
                            </svg>
                            <span>Update Password</span>
                        </button>
                    </div>
                </form>
                
                <div class="border-t border-gray-800 my-8 pt-6">
                    <h4 class="text-xl font-bold mb-2">Two-Factor Authentication</h4>
                    <p class="text-fitness-gray mb-4">Enhance your account security with two-factor authentication.</p>
                    <button type="button" class="btn btn-outline flex items-center gap-2">
                        <svg class="icon icon-sm">
                            <use xlink:href="#icon-shield"></use>
                        </svg>
                        <span>Enable 2FA</span>
                    </button>
                </div>
                
                <div class="border-t border-gray-800 my-8 pt-6">
                    <h4 class="text-xl font-bold mb-2">Connected Accounts</h4>
                    <p class="text-fitness-gray mb-4">Manage your connected social accounts.</p>
                    
                    <div class="fitness-card mb-3">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center gap-3">
                                <svg class="icon">
                                    <use xlink:href="#icon-google"></use>
                                </svg>
                                <span>Google</span>
                            </div>
                            <button class="btn btn-outline py-1 px-3">Connect</button>
                        </div>
                    </div>
                    
                    <div class="fitness-card">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center gap-3">
                                <svg class="icon">
                                    <use xlink:href="#icon-apple"></use>
                                </svg>
                                <span>Apple</span>
                            </div>
                            <button class="btn btn-outline py-1 px-3">Connect</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Notifications Tab -->
            <div id="notifications-tab" class="tab-content hidden">
                <form id="notification-settings-form">
                    <h4 class="text-xl font-bold mb-4">Email Notifications</h4>
                    
                    <div class="mb-3 flex items-center">
                        <input type="checkbox" id="email-updates" name="email-updates" 
                               class="w-4 h-4 mr-3" 
                               {% if notification_settings.email_updates %}checked{% endif %}>
                        <label for="email-updates">Product updates and announcements</label>
                    </div>
                    
                    <div class="mb-3 flex items-center">
                        <input type="checkbox" id="email-progress" name="email-progress" 
                               class="w-4 h-4 mr-3"
                               {% if notification_settings.email_progress %}checked{% endif %}>
                        <label for="email-progress">Progress reports and reminders</label>
                    </div>
                    
                    <div class="mb-3 flex items-center">
                        <input type="checkbox" id="email-tips" name="email-tips" 
                               class="w-4 h-4 mr-3"
                               {% if notification_settings.email_tips %}checked{% endif %}>
                        <label for="email-tips">Workout tips and nutritional advice</label>
                    </div>
                    
                    <div class="border-t border-gray-800 my-6 pt-6">
                        <h4 class="text-xl font-bold mb-4">In-App Notifications</h4>
                        
                        <div class="mb-3 flex items-center">
                            <input type="checkbox" id="app-reminders" name="app-reminders" 
                                   class="w-4 h-4 mr-3"
                                   {% if notification_settings.app_reminders %}checked{% endif %}>
                            <label for="app-reminders">Workout reminders</label>
                        </div>
                        
                        <div class="mb-3 flex items-center">
                            <input type="checkbox" id="app-milestones" name="app-milestones" 
                                   class="w-4 h-4 mr-3"
                                   {% if notification_settings.app_milestones %}checked{% endif %}>
                            <label for="app-milestones">Progress milestones</label>
                        </div>
                        
                        <div class="mb-3 flex items-center">
                            <input type="checkbox" id="app-updates" name="app-updates" 
                                   class="w-4 h-4 mr-3"
                                   {% if notification_settings.app_updates %}checked{% endif %}>
                            <label for="app-updates">New features and updates</label>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <button type="submit" class="btn btn-primary flex items-center gap-2">
                            <svg class="icon icon-sm">
                                <use xlink:href="#icon-save"></use>
                            </svg>
                            <span>Save Notification Preferences</span>
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Privacy Tab -->
            <div id="privacy-tab" class="tab-content hidden">
                <h4 class="text-xl font-bold mb-2">Data Privacy Controls</h4>
                <p class="text-fitness-gray mb-4">Manage how your data is used and stored.</p>
                
                <div class="mb-6">
                    <h5 class="font-bold mb-2">Data Storage</h5>
                    <p class="text-fitness-gray mb-3">Choose how long to keep your fitness data.</p>
                    <select class="fitness-select" id="data-storage" name="data-storage">
                        <option value="indefinite" {% if privacy_settings.data_storage_duration == 'indefinite' %}selected{% endif %}>Store indefinitely</option>
                        <option value="1-year" {% if privacy_settings.data_storage_duration == '1-year' %}selected{% endif %}>Keep for 1 year</option>
                        <option value="6-months" {% if privacy_settings.data_storage_duration == '6-months' %}selected{% endif %}>Keep for 6 months</option>
                        <option value="3-months" {% if privacy_settings.data_storage_duration == '3-months' %}selected{% endif %}>Keep for 3 months</option>
                    </select>
                </div>
                
                <div class="mb-6">
                    <h5 class="font-bold mb-2">Profile Visibility</h5>
                    <p class="text-fitness-gray mb-3">Control who can see your profile information.</p>
                    
                    <div class="mb-2 flex items-center">
                        <input type="radio" id="profilePrivate" name="profileVisibility" value="private"
                               class="w-4 h-4 mr-3"
                               {% if privacy_settings.profile_visibility == 'private' %}checked{% endif %}>
                        <label for="profilePrivate">Private - Only visible to you</label>
                    </div>
                    
                    <div class="flex items-center">
                        <input type="radio" id="profilePublic" name="profileVisibility" value="public"
                               class="w-4 h-4 mr-3"
                               {% if privacy_settings.profile_visibility == 'public' %}checked{% endif %}>
                        <label for="profilePublic">Public - Visible to other users</label>
                    </div>
                </div>
                
                <div class="border-t border-gray-800 my-6 pt-6">
                    <h4 class="text-xl font-bold mb-2">Download Your Data</h4>
                    <p class="text-fitness-gray mb-4">Get a copy of all your personal data stored in our system.</p>
                    <button type="button" class="btn btn-outline flex items-center gap-2">
                        <svg class="icon icon-sm">
                            <use xlink:href="#icon-download"></use>
                        </svg>
                        <span>Request Data Download</span>
                    </button>
                </div>
                
                <div class="border-t border-gray-800 my-6 pt-6">
                    <h4 class="text-xl font-bold text-fitness-red mb-2">Delete Account</h4>
                    <p class="text-fitness-gray mb-4">Permanently delete your account and all associated data.</p>
                    <button type="button" class="btn btn-outline flex items-center gap-2 border-fitness-red text-fitness-red"
                            data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
                        <svg class="icon icon-sm">
                            <use xlink:href="#icon-trash"></use>
                        </svg>
                        <span>Delete My Account</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Account Modal -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content bg-fitness-darkgray">
            <div class="modal-header border-b border-gray-800">
                <h5 class="modal-title text-fitness-red font-bold" id="deleteAccountModalLabel">Delete Account</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="font-bold mb-3">Are you sure you want to delete your account?</p>
                <p class="mb-3">This action cannot be undone and will permanently delete all your data including:</p>
                <ul class="list-disc pl-5 mb-4 text-fitness-gray">
                    <li>Profile information</li>
                    <li>Analysis results</li>
                    <li>Workout plans and progress</li>
                    <li>All uploaded body scans and photos</li>
                </ul>
                <div class="mb-3">
                    <label for="delete-confirm" class="block text-fitness-gray mb-2">Type "DELETE" to confirm:</label>
                    <input type="text" class="fitness-input" id="delete-confirm">
                </div>
            </div>
            <div class="modal-footer border-t border-gray-800">
                <button type="button" class="btn btn-outline" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirmDeleteBtn" disabled>
                    <span class="flex items-center gap-2">
                        <svg class="icon icon-sm">
                            <use xlink:href="#icon-trash"></use>
                        </svg>
                        <span>Delete Permanently</span>
                    </span>
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Tab functionality
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabName = button.dataset.tab;
                
                // Update active button
                tabButtons.forEach(btn => {
                    btn.classList.remove('active', 'border-fitness-red');
                    btn.classList.add('border-transparent', 'text-fitness-gray');
                });
                button.classList.add('active', 'border-fitness-red');
                button.classList.remove('border-transparent', 'text-fitness-gray');
                
                // Update active content
                tabContents.forEach(content => {
                    content.classList.add('hidden');
                    content.classList.remove('active');
                });
                document.getElementById(`${tabName}-tab`).classList.remove('hidden');
                document.getElementById(`${tabName}-tab`).classList.add('active');
            });
        });
        
        // Profile settings form
        const profileForm = document.getElementById('profile-settings-form');
        if (profileForm) {
            profileForm.addEventListener('submit', function(e) {
                e.preventDefault();
                alert('Profile settings saved!');
            });
        }
        
        // Password change form
        const passwordForm = document.getElementById('password-change-form');
        if (passwordForm) {
            passwordForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const newPassword = document.getElementById('new-password').value;
                const confirmPassword = document.getElementById('confirm-password').value;
                
                if (newPassword !== confirmPassword) {
                    alert('Passwords do not match!');
                    return;
                }
                
                alert('Password updated successfully!');
            });
        }
        
        // Notification settings form
        const notificationForm = document.getElementById('notification-settings-form');
        if (notificationForm) {
            notificationForm.addEventListener('submit', function(e) {
                e.preventDefault();
                alert('Notification preferences saved!');
            });
        }
        
        // Delete account confirmation
        const deleteConfirmInput = document.getElementById('delete-confirm');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        
        if (deleteConfirmInput && confirmDeleteBtn) {
            deleteConfirmInput.addEventListener('input', function() {
                confirmDeleteBtn.disabled = this.value !== 'DELETE';
            });
            
            confirmDeleteBtn.addEventListener('click', function() {
                alert('Account deleted. You will now be logged out.');
                window.location.href = '/logout';
            });
        }
    });
</script>
{% endblock %}