{% extends "tailwind_layout.html" %}

{% block content %}
<div class="mb-6">
    <div class="fitness-card">
        <div class="flex items-center gap-3 mb-4">
            <svg class="icon text-fitness-red">
                <use xlink:href="#icon-utensils"></use>
            </svg>
            <h1 class="text-3xl font-bold">Personalized Nutrition Plan</h1>
        </div>
        <div class="fitness-card bg-fitness-darkgray">
            <div class="flex items-center gap-2">
                <svg class="icon text-fitness-accent">
                    <use xlink:href="#icon-info"></use>
                </svg>
                <p class="text-fitness-gray">
                    This nutrition plan is customized based on your body type, goals, and genetic traits.
                    Follow these guidelines for optimal results alongside your training program.
                </p>
            </div>
        </div>
    </div>
</div>

<div class="grid grid-cols-1 md:grid-cols-12 gap-6">
    <div class="md:col-span-5">
        <!-- User Information -->
        <div class="fitness-card mb-6">
            <div class="flex items-center gap-3 mb-4">
                <svg class="icon text-fitness-red">
                    <use xlink:href="#icon-user"></use>
                </svg>
                <h3 class="text-xl font-bold">Your Profile</h3>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 w-full mt-4">
                <div class="fitness-card bg-fitness-darkgray">
                    <div class="flex items-center gap-2 mb-2">
                        <svg class="icon icon-sm text-fitness-accent">
                            <use xlink:href="#icon-ruler"></use>
                        </svg>
                        <h4 class="font-bold">Body Measurements</h4>
                    </div>
                    <ul class="text-sm text-fitness-gray">
                        <li class="flex justify-between items-center border-b border-gray-800 py-2">
                            <span>Height</span>
                            <span class="font-medium">{{ user_info.height }} cm</span>
                        </li>
                        <li class="flex justify-between items-center border-b border-gray-800 py-2">
                            <span>Weight</span>
                            <span class="font-medium">{{ user_info.weight }} kg</span>
                        </li>
                        {% if traits.body_fat_percentage is defined and traits.body_fat_percentage.value is defined %}
                        <li class="flex justify-between items-center border-b border-gray-800 py-2">
                            <span>Body Fat</span>
                            <span class="font-medium">{{ format_value('body_fat_percentage', traits.body_fat_percentage.value) }}%</span>
                        </li>
                        {% endif %}
                        <li class="flex justify-between items-center py-2">
                            <span>Body Type</span>
                            <span class="font-medium">{{ body_type }}</span>
                        </li>
                    </ul>
                </div>
                
                <div class="fitness-card bg-fitness-darkgray">
                    <div class="flex items-center gap-2 mb-2">
                        <svg class="icon icon-sm text-fitness-accent">
                            <use xlink:href="#icon-target"></use>
                        </svg>
                        <h4 class="font-bold">Nutrition Focus</h4>
                    </div>
                    <ul class="text-sm text-fitness-gray">
                        <li class="flex justify-between items-center border-b border-gray-800 py-2">
                            <span>Experience</span>
                            <span class="font-medium capitalize">{{ user_info.experience }}</span>
                        </li>
                        <li class="flex justify-between items-center border-b border-gray-800 py-2">
                            <span>Carb Strategy</span>
                            <span class="font-medium">{{ body_type }} Focused</span>
                        </li>
                        <li class="flex justify-between items-center py-2">
                            <span>Meal Timing</span>
                            <span class="font-medium">Optimized</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Supplements Section -->
        <div class="fitness-card">
            <div class="flex items-center gap-3 mb-4">
                <svg class="icon text-fitness-red">
                    <use xlink:href="#icon-pill"></use>
                </svg>
                <h3 class="text-xl font-bold">Supplement Recommendations</h3>
            </div>
            
            <div class="mb-4">
                <h4 class="text-lg font-bold mb-3 text-fitness-accent">Essential Supplements</h4>
                <ul class="space-y-3">
                    {% for supplement in supplements.essential %}
                    <li class="fitness-card bg-fitness-darkgray p-3">
                        <div class="flex items-start gap-2">
                            <svg class="icon icon-sm text-green-500 mt-1">
                                <use xlink:href="#icon-check"></use>
                            </svg>
                            <div>
                                <span class="font-medium text-green-500">{{ supplement.name }}</span>
                                <p class="text-sm text-fitness-gray mt-1">{{ supplement.purpose }}</p>
                                <div class="flex flex-wrap gap-x-4 mt-2">
                                    <span class="text-xs text-fitness-gray">
                                        <span class="text-fitness-accent">Timing:</span> {{ supplement.timing }}
                                    </span>
                                    <span class="text-xs text-fitness-gray">
                                        <span class="text-fitness-accent">Dosage:</span> {{ supplement.dosage }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            
            <div>
                <h4 class="text-lg font-bold mb-3 text-fitness-accent">Optional Supplements</h4>
                <ul class="space-y-3">
                    {% for supplement in supplements.optional %}
                    <li class="fitness-card bg-fitness-darkgray p-3">
                        <div class="flex items-start gap-2">
                            <svg class="icon icon-sm text-blue-500 mt-1">
                                <use xlink:href="#icon-plus"></use>
                            </svg>
                            <div>
                                <span class="font-medium text-blue-500">{{ supplement.name }}</span>
                                <p class="text-sm text-fitness-gray mt-1">{{ supplement.purpose }}</p>
                                <div class="flex flex-wrap gap-x-4 mt-2">
                                    <span class="text-xs text-fitness-gray">
                                        <span class="text-fitness-accent">Timing:</span> {{ supplement.timing }}
                                    </span>
                                    <span class="text-xs text-fitness-gray">
                                        <span class="text-fitness-accent">Dosage:</span> {{ supplement.dosage }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
    
    <div class="md:col-span-7">
        <!-- Calorie and Macros Section -->
        <div class="fitness-card mb-6">
            <div class="flex items-center gap-3 mb-4">
                <svg class="icon text-fitness-red">
                    <use xlink:href="#icon-bar-chart"></use>
                </svg>
                <h3 class="text-xl font-bold">Calorie & Macro Breakdown</h3>
            </div>
            
            <!-- Calorie Recommendations -->
            <div class="fitness-card bg-fitness-darkgray mb-4">
                <div class="flex items-center gap-2 mb-3">
                    <svg class="icon icon-sm text-fitness-accent">
                        <use xlink:href="#icon-flame"></use>
                    </svg>
                    <h4 class="font-bold">Calorie Targets</h4>
                </div>
                
                {% if recommendations.calorie_recommendations is defined %}
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3">
                    <div class="fitness-card bg-fitness-card-bg border border-gray-800 flex flex-col items-center p-4">
                        <span class="text-sm text-fitness-gray mb-1">Maintenance</span>
                        <span class="text-2xl font-bold text-white">{{ recommendations.calorie_recommendations.maintenance }} kcal</span>
                    </div>
                    
                    {% if recommendations.calorie_recommendations.training_day is defined and recommendations.calorie_recommendations.rest_day is defined and recommendations.calorie_recommendations.training_day != recommendations.calorie_recommendations.rest_day %}
                    <div class="fitness-card bg-fitness-card-bg border border-gray-800 flex flex-col items-center p-4">
                        <span class="text-sm text-fitness-gray mb-1">Training Days</span>
                        <span class="text-2xl font-bold text-green-500">{{ recommendations.calorie_recommendations.training_day }} kcal</span>
                    </div>
                    <div class="fitness-card bg-fitness-card-bg border border-gray-800 flex flex-col items-center p-4">
                        <span class="text-sm text-fitness-gray mb-1">Rest Days</span>
                        <span class="text-2xl font-bold text-blue-500">{{ recommendations.calorie_recommendations.rest_day }} kcal</span>
                    </div>
                    {% else %}
                    <div class="fitness-card bg-fitness-card-bg border border-gray-800 flex flex-col items-center p-4">
                        <span class="text-sm text-fitness-gray mb-1">Daily Target</span>
                        <span class="text-2xl font-bold text-green-500">{{ recommendations.calorie_recommendations.target }} kcal</span>
                    </div>
                    <div class="fitness-card bg-fitness-card-bg border border-gray-800 flex flex-col items-center p-4">
                        <span class="text-sm text-fitness-gray mb-1">Weekly Total</span>
                        <span class="text-2xl font-bold text-blue-500">{{ recommendations.calorie_recommendations.target * 7 }} kcal</span>
                    </div>
                    {% endif %}
                </div>
                {% else %}
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3">
                    <div class="fitness-card bg-fitness-card-bg border border-gray-800 flex flex-col items-center p-4">
                        <span class="text-sm text-fitness-gray mb-1">Maintenance</span>
                        <span class="text-2xl font-bold text-white">2200 kcal</span>
                    </div>
                    <div class="fitness-card bg-fitness-card-bg border border-gray-800 flex flex-col items-center p-4">
                        <span class="text-sm text-fitness-gray mb-1">Target</span>
                        <span class="text-2xl font-bold text-green-500">2300 kcal</span>
                    </div>
                    <div class="fitness-card bg-fitness-card-bg border border-gray-800 flex flex-col items-center p-4">
                        <span class="text-sm text-fitness-gray mb-1">Weekly Total</span>
                        <span class="text-2xl font-bold text-blue-500">16,100 kcal</span>
                    </div>
                </div>
                {% endif %}
                
                <p class="text-sm text-fitness-gray mt-2">These calorie targets are based on your body metrics, activity level, and goals. Adjust as needed based on your progress and performance.</p>
            </div>
            
            <!-- Macro Split Section -->
            <div class="fitness-card bg-fitness-darkgray mb-5">
                <div class="flex items-center gap-2 mb-3">
                    <svg class="icon icon-sm text-fitness-accent">
                        <use xlink:href="#icon-coffee"></use>
                    </svg>
                    <h4 class="font-bold">Macro Split</h4>
                </div>
                
                {% if recommendations.nutrition is defined and recommendations.nutrition.macros is defined %}
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3">
                    {% for macro in recommendations.nutrition.macros %}
                        <div class="fitness-card bg-fitness-card-bg border border-gray-800 flex flex-col items-center">
                            <span class="text-xl font-bold 
                                {% if macro.name == 'Protein' %}text-red-500
                                {% elif macro.name == 'Carbs' %}text-blue-500
                                {% elif macro.name == 'Fat' %}text-yellow-500
                                {% endif %}">
                                {{ macro.percentage }}%
                            </span>
                            <span class="text-sm text-fitness-gray">{{ macro.name }}</span>
                            <span class="text-xs text-fitness-gray mt-1">{{ macro.grams }}</span>
                        </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3">
                    <div class="fitness-card bg-fitness-card-bg border border-gray-800 flex flex-col items-center">
                        <span class="text-xl font-bold text-red-500">40%</span>
                        <span class="text-sm text-fitness-gray">Protein</span>
                        <span class="text-xs text-fitness-gray mt-1">2g per kg bodyweight</span>
                    </div>
                    <div class="fitness-card bg-fitness-card-bg border border-gray-800 flex flex-col items-center">
                        <span class="text-xl font-bold text-blue-500">40%</span>
                        <span class="text-sm text-fitness-gray">Carbs</span>
                        <span class="text-xs text-fitness-gray mt-1">Based on activity level</span>
                    </div>
                    <div class="fitness-card bg-fitness-card-bg border border-gray-800 flex flex-col items-center">
                        <span class="text-xl font-bold text-yellow-500">20%</span>
                        <span class="text-sm text-fitness-gray">Fat</span>
                        <span class="text-xs text-fitness-gray mt-1">Essential for hormones</span>
                    </div>
                </div>
                {% endif %}
                
                <!-- Carb Strategy based on body type -->
                <div class="fitness-card bg-fitness-card-bg border border-gray-800 p-3 mt-3">
                    <div class="flex items-start gap-2">
                        <svg class="icon icon-sm text-blue-500 mt-1">
                            <use xlink:href="#icon-zap"></use>
                        </svg>
                        <div>
                            <span class="font-medium text-blue-500">Carb Strategy for {{ body_type }} Body Type</span>
                            <p class="text-sm text-fitness-gray mt-1">{{ carb_strategy }}</p>
                        </div>
                    </div>
                </div>
                
                <!-- Meal Timing Strategy -->
                <div class="fitness-card bg-fitness-card-bg border border-gray-800 p-3 mt-3">
                    <div class="flex items-start gap-2">
                        <svg class="icon icon-sm text-green-500 mt-1">
                            <use xlink:href="#icon-clock"></use>
                        </svg>
                        <div>
                            <span class="font-medium text-green-500">Meal Timing Strategy</span>
                            <p class="text-sm text-fitness-gray mt-1">{{ timing_strategy }}</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Food Recommendations -->
            <div class="fitness-card bg-fitness-darkgray">
                <div class="flex items-center gap-2 mb-4">
                    <svg class="icon icon-sm text-fitness-accent">
                        <use xlink:href="#icon-utensils"></use>
                    </svg>
                    <h4 class="font-bold">Recommended Foods</h4>
                </div>
                
                <!-- Protein sources -->
                <div class="mb-4">
                    <h5 class="text-md font-semibold mb-2 text-red-400">Protein Sources</h5>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        {% for food in foods.protein_sources %}
                        <div class="fitness-card bg-fitness-card-bg border border-gray-800 p-3">
                            <div class="flex items-start">
                                <div>
                                    <span class="font-medium text-white">{{ food.name }}</span>
                                    <p class="text-xs text-fitness-gray mt-1">{{ food.benefits }}</p>
                                    <p class="text-xs text-fitness-accent mt-1">{{ food.portion }}</p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- Carb sources -->
                <div class="mb-4">
                    <h5 class="text-md font-semibold mb-2 text-blue-400">Carbohydrate Sources</h5>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        {% for food in foods.carb_sources %}
                        <div class="fitness-card bg-fitness-card-bg border border-gray-800 p-3">
                            <div class="flex items-start">
                                <div>
                                    <span class="font-medium text-white">{{ food.name }}</span>
                                    <p class="text-xs text-fitness-gray mt-1">{{ food.benefits }}</p>
                                    <p class="text-xs text-fitness-accent mt-1">{{ food.portion }}</p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- Fat sources -->
                <div>
                    <h5 class="text-md font-semibold mb-2 text-yellow-400">Healthy Fat Sources</h5>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        {% for food in foods.fat_sources %}
                        <div class="fitness-card bg-fitness-card-bg border border-gray-800 p-3">
                            <div class="flex items-start">
                                <div>
                                    <span class="font-medium text-white">{{ food.name }}</span>
                                    <p class="text-xs text-fitness-gray mt-1">{{ food.benefits }}</p>
                                    <p class="text-xs text-fitness-accent mt-1">{{ food.portion }}</p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Nutrition Tips Section -->
        <div class="fitness-card">
            <div class="flex items-center gap-3 mb-4">
                <svg class="icon text-fitness-red">
                    <use xlink:href="#icon-book"></use>
                </svg>
                <h3 class="text-xl font-bold">Nutrition Recommendations</h3>
            </div>
            
            {% if recommendations.nutrition is defined and recommendations.nutrition.tips is defined %}
            <ul class="text-sm text-fitness-gray space-y-2">
                {% for tip in recommendations.nutrition.tips %}
                    <li class="flex items-start gap-2">
                        <svg class="icon icon-xs text-fitness-red mt-1">
                            <use xlink:href="#icon-chevron-right"></use>
                        </svg>
                        <span>{{ tip }}</span>
                    </li>
                {% endfor %}
            </ul>
            {% else %}
            <ul class="text-sm text-fitness-gray space-y-2">
                <li class="flex items-start gap-2">
                    <svg class="icon icon-xs text-fitness-red mt-1">
                        <use xlink:href="#icon-chevron-right"></use>
                    </svg>
                    <span>Prioritize protein intake with every meal to support muscle recovery and growth.</span>
                </li>
                <li class="flex items-start gap-2">
                    <svg class="icon icon-xs text-fitness-red mt-1">
                        <use xlink:href="#icon-chevron-right"></use>
                    </svg>
                    <span>Time carbohydrates around your workouts for optimal performance and recovery.</span>
                </li>
                <li class="flex items-start gap-2">
                    <svg class="icon icon-xs text-fitness-red mt-1">
                        <use xlink:href="#icon-chevron-right"></use>
                    </svg>
                    <span>Include healthy fats throughout the day to support hormone production.</span>
                </li>
                <li class="flex items-start gap-2">
                    <svg class="icon icon-xs text-fitness-red mt-1">
                        <use xlink:href="#icon-chevron-right"></use>
                    </svg>
                    <span>Stay hydrated by drinking at least 3-4 liters of water daily.</span>
                </li>
                <li class="flex items-start gap-2">
                    <svg class="icon icon-xs text-fitness-red mt-1">
                        <use xlink:href="#icon-chevron-right"></use>
                    </svg>
                    <span>Aim for 80% whole, minimally processed foods and 20% flexibility for sustainability.</span>
                </li>
            </ul>
            {% endif %}
            
            <div class="fitness-card bg-fitness-darkgray mt-4">
                <div class="flex items-center gap-2">
                    <svg class="icon text-fitness-accent">
                        <use xlink:href="#icon-alert-circle"></use>
                    </svg>
                    <p class="text-fitness-gray text-sm">
                        This nutrition plan serves as a guide. Adjust based on your progress, energy levels, and performance. 
                        For personalized advice, consider consulting with a registered dietitian.
                    </p>
                </div>
            </div>
            
            <div class="flex gap-3 mt-6">
                <a href="{{ url_for('recommendations', analysis_id=analysis_id) }}" class="fitness-button-secondary flex items-center gap-2">
                    <svg class="icon icon-sm">
                        <use xlink:href="#icon-arrow-left"></use>
                    </svg>
                    Back to Recommendations
                </a>
                <a href="{{ url_for('workout', analysis_id=analysis_id) }}" class="fitness-button-primary flex items-center gap-2">
                    View Workout Plan
                    <svg class="icon icon-sm">
                        <use xlink:href="#icon-arrow-right"></use>
                    </svg>
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}