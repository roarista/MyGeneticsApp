{% extends "tailwind_layout.html" %}

{% block title %}Your Body Analysis Results{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
  <!-- Page Header -->
  <div class="text-center mb-12">
    <h1 class="text-4xl font-bold text-white mb-2">Your Body Analysis Results</h1>
    <p class="text-gray-400">Genetic insights based on your uploaded photos and measurements</p>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Left Panel: Your Analysis & Key Metrics -->
    <div class="space-y-6">
      <!-- Analysis Image & Description -->
      <div class="bg-gray-800 rounded-xl shadow-lg p-6">
        <h2 class="text-2xl font-semibold text-white mb-4">Your Analysis</h2>
        <img src="data:image/jpeg;base64,{{ image_data }}" alt="Body Analysis" class="w-full h-auto rounded-lg">
        <div class="mt-4">
          <span class="inline-block bg-blue-600 text-white px-3 py-1 rounded-full">Body Type: {{ traits.body_type }}</span>
        </div>
        <p class="text-gray-300 mt-4">{{ traits.description }}</p>
      </div>

      <!-- Key Measurements -->
      <div class="bg-gray-800 rounded-xl shadow-lg p-6">
        <h2 class="text-2xl font-semibold text-white mb-4">Key Measurements</h2>
        <div class="grid grid-cols-2 gap-4">
          {% if measurements.shoulder_width %}
          <div class="space-y-1">
            <div class="text-white font-bold">{{ measurements.shoulder_width }} cm</div>
            <div class="text-gray-400 text-sm">Shoulder Width</div>
          </div>
          {% endif %}
          {% if measurements.waist_circumference %}
          <div class="space-y-1">
            <div class="text-white font-bold">{{ measurements.waist_circumference }} cm</div>
            <div class="text-gray-400 text-sm">Waist Circumference</div>
          </div>
          {% endif %}
          {% if bodybuilding.body_fat_percentage %}
          <div class="space-y-1">
            <div class="text-white font-bold">{{ '{:.1f}'.format(bodybuilding.body_fat_percentage) }}%</div>
            <div class="text-gray-400 text-sm">Body Fat %</div>
          </div>
          {% endif %}
          {% if measurements.arm_circumference %}
          <div class="space-y-1">
            <div class="text-white font-bold">{{ measurements.arm_circumference }} cm</div>
            <div class="text-gray-400 text-sm">Arm Circumference</div>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Body Metrics Charts -->
      <div class="bg-gray-800 rounded-xl shadow-lg p-6">
        <h2 class="text-2xl font-semibold text-white mb-4"><i class="fas fa-chart-bar mr-2"></i>Body Metrics Overview</h2>
        <canvas id="symmetryChart" height="200"></canvas>
        <canvas id="dominanceChart" height="200" class="mt-4"></canvas>
        <canvas id="fiberChart" height="200" class="mt-4"></canvas>
      </div>
    </div>

    <!-- Right Panel: Genetic Traits & Recommendations -->
    <div class="lg:col-span-2 space-y-6">
      <!-- Genetic Structure Traits Table -->
      <div class="bg-gray-800 rounded-xl shadow-lg p-6 overflow-auto">
        <h2 class="text-2xl font-semibold text-white mb-4">Genetic Structure Traits</h2>
        <table class="min-w-full table-auto">
          <thead class="bg-gray-700">
            <tr>
              <th class="px-4 py-2 text-left text-gray-300">Trait</th>
              <th class="px-4 py-2 text-left text-gray-300">Value</th>
              <th class="px-4 py-2 text-left text-gray-300">Rating</th>
              <th class="px-4 py-2 text-left text-gray-300">Impact</th>
            </tr>
          </thead>
          <tbody class="bg-gray-900">
            {% if traits.get('bicep_insertion') %}
            <tr class="border-b border-gray-700">
              <td class="px-4 py-3 text-white">Bicep Insertion</td>
              <td class="px-4 py-3 text-gray-300">{{ traits.get('bicep_insertion') }}</td>
              <td class="px-4 py-3">
                <span class="px-2 py-1 rounded-full text-xs
                  {% if traits.get('bicep_insertion')=='High' %}bg-green-500
                  {% elif traits.get('bicep_insertion')=='Low' %}bg-blue-500
                  {% else %}bg-yellow-500{% endif %}">
                  {{ 'Excellent' if traits.get('bicep_insertion')=='Low' else 'Good' }}
                </span>
              </td>
              <td class="px-4 py-3 text-gray-300">Affects bicep peak and overall arm appearance</td>
            </tr>
            {% endif %}
            {% if traits.get('fast_twitch_percentage') %}
            <tr class="border-b border-gray-700">
              <td class="px-4 py-3 text-white">Fast-Twitch Dominant</td>
              <td class="px-4 py-3 text-gray-300">{{ traits.get('fast_twitch_percentage') }}%</td>
              <td class="px-4 py-3">
                <span class="px-2 py-1 rounded-full text-xs
                  {% if traits.get('fast_twitch_percentage', 0) > 60 %}bg-green-500
                  {% elif traits.get('fast_twitch_percentage', 0) < 40 %}bg-red-500
                  {% else %}bg-yellow-500{% endif %}">
                  {{ 'Excellent' if traits.get('fast_twitch_percentage', 0) > 60 else 'Average' if traits.get('fast_twitch_percentage', 0) >= 40 else 'Fair' }}
                </span>
              </td>
              <td class="px-4 py-3 text-gray-300">Determines strength vs endurance potential</td>
            </tr>
            {% endif %}
            {% if traits.get('frame_size') %}
            <tr class="border-b border-gray-700">
              <td class="px-4 py-3 text-white">Frame Size</td>
              <td class="px-4 py-3 text-gray-300">{{ traits.get('frame_size') }}</td>
              <td class="px-4 py-3">
                <span class="px-2 py-1 rounded-full text-xs
                  {% if traits.get('frame_size')=='Large' %}bg-green-500
                  {% elif traits.get('frame_size')=='Small' %}bg-red-500
                  {% else %}bg-yellow-500{% endif %}">
                  {{ 'Excellent' if traits.get('frame_size')=='Large' else 'Average' if traits.get('frame_size')=='Medium' else 'Fair' }}
                </span>
              </td>
              <td class="px-4 py-3 text-gray-300">Influences overall muscle mass potential</td>
            </tr>
            {% endif %}
            {% if traits.get('muscle_building_potential') %}
            <tr class="border-b border-gray-700">
              <td class="px-4 py-3 text-white">Muscle Potential</td>
              <td class="px-4 py-3 text-gray-300">{{ '{:.1f}'.format(traits.get('muscle_building_potential')) }}/10</td>
              <td class="px-4 py-3">
                <span class="px-2 py-1 rounded-full text-xs
                  {% if traits.get('muscle_building_potential', 0) > 7.5 %}bg-green-500
                  {% elif traits.get('muscle_building_potential', 0) < 5 %}bg-red-500
                  {% else %}bg-yellow-500{% endif %}">
                  {{ 'Excellent' if traits.get('muscle_building_potential', 0) > 7.5 else 'Average' if traits.get('muscle_building_potential', 0) >= 5 else 'Fair' }}
                </span>
              </td>
              <td class="px-4 py-3 text-gray-300">Overall genetic predisposition for hypertrophy</td>
            </tr>
            {% endif %}
          </tbody>
        </table>
      </div>

      <!-- Recommendations Section -->
      <div class="bg-gray-800 rounded-xl shadow-lg p-6">
        <h2 class="text-2xl font-semibold text-white mb-4">Personalized Recommendations</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h3 class="text-lg font-medium text-blue-400 mb-2">Genetic Strengths</h3>
            <ul class="list-disc list-inside text-gray-300 space-y-1">
              {% if traits.get('fast_twitch_percentage', 0) > 60 %}
                <li>Excellent power/strength development</li>
              {% endif %}
              {% if bodybuilding.get('muscle_building_potential', 0) > 7 %}
                <li>Above-average muscle building genetics</li>
              {% endif %}
              {% if traits.get('frame_size') == 'Large' %}
                <li>Large frame supports more overall muscle</li>
              {% endif %}
              {% if measurements.shoulder_width and measurements.shoulder_width > 45 %}
                <li>Wide shoulders create an aesthetic V-taper</li>
              {% endif %}
            </ul>
          </div>
          <div>
            <h3 class="text-lg font-medium text-yellow-400 mb-2">Areas to Focus On</h3>
            <ul class="list-disc list-inside text-gray-300 space-y-1">
              {% if traits.get('fast_twitch_percentage', 0) < 40 %}
                <li>Strength training (compensate for lower fast-twitch %)</li>
              {% endif %}
              {% if bodybuilding.body_fat_percentage > 18 %}
                <li>Fat loss protocols to improve definition</li>
              {% endif %}
              {% if measurements.waist_circumference and measurements.waist_circumference > 90 %}
                <li>Core strengthening and waist reduction</li>
              {% endif %}
              {% if traits.get('frame_size') == 'Small' %}
                <li>Focus on creating illusion of size through proportions</li>
              {% endif %}
            </ul>
          </div>
        </div>
        <div class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div>
            <h3 class="text-lg font-medium text-green-400 mb-2">Training Tips</h3>
            <ul class="list-disc list-inside text-gray-300 space-y-1">
              {% if traits.get('fast_twitch_percentage', 0) > 60 %}
                <li>Emphasize heavy, compound movements</li>
                <li>Lower rep ranges (4-8) for maximum growth</li>
              {% elif traits.get('fast_twitch_percentage', 0) < 40 %}
                <li>Include both strength and endurance protocols</li>
                <li>Moderate rep ranges (8-12) with shorter rest</li>
              {% else %}
                <li>Balanced training approach with periodization</li>
                <li>Varied rep ranges to stimulate all fiber types</li>
              {% endif %}
            </ul>
          </div>
          <div>
            <h3 class="text-lg font-medium text-red-400 mb-2">Nutrition Tips</h3>
            <ul class="list-disc list-inside text-gray-300 space-y-1">
              {% if bodybuilding.body_fat_percentage > 18 %}
                <li>Moderate caloric deficit (300-500 calories)</li>
                <li>Higher protein intake (1.8-2.2g per kg bodyweight)</li>
              {% elif bodybuilding.body_fat_percentage < 10 %}
                <li>Caloric surplus for muscle growth (300-500 calories)</li>
                <li>Carb timing around workouts for performance</li>
              {% else %}
                <li>Maintenance calories with nutrient cycling</li>
                <li>Protein intake of 1.6-2.0g per kg bodyweight</li>
              {% endif %}
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="mt-8 flex flex-wrap justify-center gap-4">
    <a href="/workout/{{ analysis_id }}" class="btn-primary">
      <i class="fas fa-dumbbell mr-2"></i> Get Workout Plan
    </a>
    <a href="/nutrition/{{ analysis_id }}" class="btn-outline">
      <i class="fas fa-utensils mr-2"></i> Nutrition Guidelines
    </a>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Embed data for JavaScript charts
    window.traits = {{ traits|tojson }};
    window.recommendations = {{ recommendations|tojson if recommendations is defined else {}|tojson }};
    window.measurements = {{ measurements|tojson }};
    window.bodybuilding = {{ bodybuilding|tojson }};
</script>
<script src="{{ url_for('static', filename='js/body_type_fixes.js') }}"></script>
<script src="{{ url_for('static', filename='js/chart_utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/improved_body_type_charts.js') }}"></script>
<script src="{{ url_for('static', filename='js/fitness_metrics_charts.js') }}"></script>
<script>
    // Chart.js setup for visualizations
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Data loaded:', { traits: window.traits, measurements: window.measurements, bodybuilding: window.bodybuilding });
    });
</script>
{% endblock %}